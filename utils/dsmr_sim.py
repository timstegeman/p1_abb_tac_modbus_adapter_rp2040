#!/usr/bin/python3

import time

import serial

PORT = "/dev/serial/by-id/usb-Silicon_Labs_CP2104_USB_to_UART_Bridge_Controller_011F15F2-if00-port0"
BAUD_RATE = 115200
INTERVAL = 1
TELEGRAM = '''
/Ene5\T210-D ESMR5.0

1-3:0.2.8(50)
0-0:1.0.0(230107170525W)
0-0:96.1.1(4530303438303030303332303631353139)
1-0:1.8.1(006184.667*kWh)
1-0:1.8.2(004762.136*kWh)
1-0:2.8.1(004708.286*kWh)
1-0:2.8.2(011405.268*kWh)
0-0:96.14.0(0001)
1-0:1.7.0(00.258*kW)
1-0:2.7.0(00.000*kW)
0-0:96.7.21(00082)
0-0:96.7.9(00021)
1-0:99.97.0(7)(0-0:96.7.19)(220416174436S)(0000001183*s)(220409124204S)(0000002103*s)(200713153049S)(0000000977*s)(190621075419S)(0000003647*s)(190409135249S)(0000040586*s)(190409023338S)(0000003752*s)(190316164111W)(0000000303*s)
1-0:32.32.0(00007)
1-0:52.32.0(00007)
1-0:72.32.0(00007)
1-0:32.36.0(00000)
1-0:52.36.0(00000)
1-0:72.36.0(00000)
0-0:96.13.0()
1-0:32.7.0(234.0*V)
1-0:52.7.0(236.0*V)
1-0:72.7.0(236.0*V)
1-0:31.7.0(001*A)
1-0:51.7.0(001*A)
1-0:71.7.0(000*A)
1-0:21.7.0(00.098*kW)
1-0:41.7.0(00.159*kW)
1-0:61.7.0(00.000*kW)
1-0:22.7.0(00.000*kW)
1-0:42.7.0(00.000*kW)
1-0:62.7.0(00.000*kW)
0-1:24.1.0(003)
0-1:96.1.0(4730303539303033383434303238393139)
0-1:24.2.1(230107170500W)(03133.361*m3)
!824A
'''

with serial.Serial(PORT, BAUD_RATE) as ser:
    i = 0
    current = 5
    while True:
        i = i + 1
        print("Sending telegram", i, end='\r')
        for line in TELEGRAM.splitlines():
            ser.write(line.strip().encode('US-ASCII') + b"\r\n")
        time.sleep(INTERVAL)
